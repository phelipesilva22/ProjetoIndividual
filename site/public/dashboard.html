<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Orquestra CCB</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="assets/favicon/image.png" type="image/x-icon">
    <script src="js/sessao.js"></script>
</head>
<body onload="pontuacaoUsuario()"> 

    <header class="dashboard-header">
        <h1>Dashboard - Orquestra CCB</h1>
        <p>Visão geral dos resultados do quiz</p>
        <div class="janela">
            <div class="header-left">
              <h1>Orquestra CCB</h1>
        
              <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
              </div>
        
              <div class="btn-nav">
                <a href="quiz.html">
                    <h3>Quiz</h3>
                </a>
              </div>
    
              <div class="btn-nav">
                <a href="dashboard.html">
                    <h3>Dashboard</h3>
                </a>
              </div>
        
              <div class="btn-logout" onclick="voltar()">
                <h3>Sair</h3>
              </div>
            </div>
    

    </header>
    <main class="dashboard-main">
        <section class="kpis">
            <div class="kpi">
                <h2>Pergunta com Maior Acerto</h2>
                <p>Qual foi o objetivo da criação da orquestra?</p>
                <span class="value">92%</span>
            </div>
            <div class="kpi">
                <h2>Pontuação Média</h2>
                <p>Desempenho geral dos participantes</p>
                <span class="value">7.8 / 10</span>
            </div>
            <div class="kpi">
                <h2>Total de Participantes</h2>
                <p>Usuários que completaram o quiz</p>
                <span class="value">45</span>
            </div>
            <div class="kpi">
                <h2>Top 3 Acertos</h2>
                <ol class="top3">
                    <li>1º - João Silva (10/10)</li>
                    <li>2º - Maria Souza (9/10)</li>
                    <li>3º - Carlos Lima (9/10)</li>
                </ol>
            </div>
        </section>
        <div class="chart-container">
            <canvas id="myChart" style="width: 400vh;"></canvas>
          </div>
    </main>
   <!--  <footer class="dashboard-footer">
        <p>Desenvolvido por Phelipe Bruione</p>
    </footer> -->
</body>
</html>



<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    
    function pontuacaoUsuario()
    {
        var idUsuario = sessionStorage.ID_USUARIO

        fetch(`/pontuacao/pontuacaoUsuario/${idUsuario} `, {
            cache: "no-store"

        })
        .then(function (resposta) {
            if (resposta.ok){
                console.log(resposta)

                resposta.json().then(json =>{
                    let labels = []
                    console.log(json)
                    let dados = {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Acertos',
                                data: [],
                                fill: false,
                                backgroundColor:[
                                'rgba(127, 255, 212, 0.473)',
                                ],
                                borderColor: '#a783e082',
                                tension: 0.1   
                            },
                            {
                                label: 'Erros',
                                data: [],
                                fill: false,
                                backgroundColor: [
                                '#5763aca8',
                                ],
                                borderColor: '#5763ac',
                                tension: 0.1
                            }
                        ]
                    }

                    for (var i = 0; i < json.length; i++){
                        dados.datasets[0].data.push(registro.acerto)
                        dados.datasets[1].data.push(registro.erros)
                    }

                    const config = {
                        type: 'bar',
                        data: dados,
                    }
                    
                    let myChart = new Chart(
                        document.getElementById("grafico"),
                        config
                    )


                })
            }  else {
                console.log("Resposta não OK: ", resposta.status)
            }
        })
        .catch(function (erro){
            console.log("Erro na requisição: ", erro)
        })

        return false
    }


    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Erros', 'Acertos'],
            datasets: [{
                label: 'Respostas',
                data: [0, 10],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            maintainAspectRatio: false, // Permite ajuste do tamanho
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
